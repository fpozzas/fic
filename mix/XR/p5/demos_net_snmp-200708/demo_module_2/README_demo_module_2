
README for demo_module_2
***********************************************************************

This example performs data retrieval and data setting for a simple
table that provides file monitoring.


Introduction
------------

The demo_module_2.c code was generated by using  "mib2c -c mib2c.iterate.conf" 
against the me2FileTable group in the SDK-DEMO2-MIB. Some functions have been 
added to the generated code to implement a link list to provide the test data.

mib2c created templates called me2FileTable.c and me2FileTable.h. 
These were renamed demo_module_2.c and demo_module_2.h for this demo.  
Within me2FileTable.c, mib2c generated init_me2FileTable, and this was renamed
to init_demo_module_2.

Note that even though the SDK-DEMO2-MIB.txt MIB file contains the
specification of table and scalar, running mib2c with mib2c.iterate.conf
generates template code only for the simple table in the MIB.



How to Build the demo_module_2 Code Example
===========================================

Files:

* Makefile - makefile to build demo_module_2.so shared library file
* demo_module_2.c  - module source code
* demo_module_2.h - module header file
* SDK-DEMO2-MIB.txt - MIB file 


To set up your build environment for the demo:

1. Copy the demo code to a directory for which you have write permission.
   For example:
   $ cp -R demo_module_2  $HOME/XR/demo


2. Create a lib directory that you can use to store shared object libraries 
   that you generate from demo code examples, if you have not already done so.
 
   For example:
   $ mkdir $HOME/XR/demo/lib

    
3. Create a mibs directory that you can use to store MIB files for the demo 
   code examples, if you have not already done so. 
   For example:
   $ mkdir $HOME/.snmp/mibs


To generate code templates from the sample MIB:


1. Change to the directory where you copied the demo module files. 
   For example:

   $ cd $HOME/XR/demo/demo_module_2
   

2. Copy the SDK-DEMO2-MIB.txt file to the mibs directory you created for the 
   demos, if you have not already done so.
   For example:
  
   $ cp SDK-DEMO2-MIB.txt $HOME/.snmp/mibs

      
3. Set your MIBS and MIBDIRS environment variables to
   include the appropriate paths.  
   For example, in the csh: 
    
   $ export MIBS=+SDK-DEMO2-MIB ( or $ export MIBS=ALL )
   
 
4. Run mib2c on the me2ContactInfoTable group in the SDK-DEMO2-MIB.
   For example:
   
   $ mib2c -c mib2c.iterate.conf me2FileTable

   The mib2c utility generates the following template files:
   me2FileTable.c 
   me2FileTable.h
   

5. Compare the template files with the demo_module_2.c and the
   demo_module_2.h files.    
   


To build the example:

1. Change to the directory where you copied the demo module files. 
   For example:

   $ cd $HOME/XR/demo/demo_module_2
   

2. Use the make command to generate object files.

   $ make
   

3. Copy the module shared library object to the lib directory you created. 
   For example:

   $ cp demo_module_2.so $HOME/XR/demo/lib
   

4. Copy the SDK-DEMO2-MIB.tx file to the mibs directory you created 
   for the demos, if you have not already done so.
   For example:
     
   $ cp SDK-DEMO2-MIB.txt $HOME/.snmp/mibs



Setting Up Agent to Run demo_module_2
=====================================
    
1. Edit the agent's configuration file $HOME/.snmp/snmpd.conf,
   and insert a dlmod statement for the module. This statement enables 
   the agent to load the module.
   For example:
   
   dlmod demo_module_2 $HOME/XR/demo/lib/demo_module_2.so
   
    
2. Start the snmp agent. If the agent is already running, 
   stop and restart it in debug mode.
   For example:
   
    $ snmpd -Lo -f -Ddemo_module_2 <port>
    
    The optional -Ddemo_module_2 argument sends debugging statements from 
    demo_module_2. The -Lo option to send debugging statements to the screen 
    instead.



Testing the Module
==================

1. Set your MIBS and MIBDIRS environment variables to
   include the appropriate paths.  
   For example, in the csh: 
    
   $ export MIBS=+SDK-DEMO2-MIB
   
   
2. Issue snmptable commands to retrieve table data from the module.

   For example:
   
   $ snmptable -v1 -c <community> <host>:<port> SDK-DEMO2-MIB::me2FileTable 
   
   SNMP table: SDK-DEMO2-MIB::me2FileTable

   me2FileIndex    me2FileName    me2FileSize    me2FilePerm
              1     /etc/hosts            254            644
              2    /etc/passwd           1266            644

3. Issue an snmpset command to specify a different file name in the first row.  

   $ snmpset -v1 -c <community> <host>:<port> SDK-DEMO2-MIB::me2FileName.1 = "/etc/crontab" 

   SDK-DEMO2-MIB::me2FileName.1 = STRING: /etc/crontab

4. Verify the results of the set request by using the snmptable command.

   For example: 

   $ snmptatable -v1 -c <community> <host>:<port>  SDK-DEMO2-MIB::me2FileTable
 
   SNMP table: SDK-DEMO2-MIB::me2FileTable

   me2FileIndex    me2FileName    me2FileSize    me2FilePerm
              1   /etc/crontab            651             644
              2    /etc/passwd           1266             644

5. Verify that the file information that you changed is not saved across
   agent restarts by restarting the agent and repeating the snmptable
   in step 4.
   
   For example:
   
   $ snmpd -f <port>
   $ snmptable -v1 -c <community> <host>:<port>  SDK-DEMO2-MIB::me2FileTable
 
   SNMP table: SDK-DEMO2-MIB::me2FileTable

   me2FileIndex    me2FileName    me2FileSize    me2FilePerm
              1     /etc/hosts            254             644
              2    /etc/passwd           1266             644

6. Issue an snmpset command to specify a new file name.  

   $ snmpset -v1 -c <community> <host>:<port> SDK-DEMO2-MIB::me2FileName.3 = "/etc/crontab"
 
   SDK-DEMO2-MIB::me2FileName.3 = STRING: /etc/crontab

7. Verify the results of the set request by using the snmptable command.
   
   For example:
   
   $ snmptable -v1 -c <community> <host>:<port>  SDK-DEMO2-MIB::me2FileTable

   SNMP table: SDK-DEMO2-MIB::me2FileTable

   me2FileIndex    me2FileName    me2FileSize    me2FilePerm
              1     /etc/hosts            254             644
              2    /etc/passwd           1266             644
              3   /etc/crontab            651             644
