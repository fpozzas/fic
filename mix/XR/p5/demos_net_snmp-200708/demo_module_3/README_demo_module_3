
README for demo_module_3
***********************************************************************

This example module demonstrates the following features:
     - Automatic Refresh of data at regular intervals
     - Check for alarm condition at regular intervals and generate trap if 
       needed.
     - Read threshold values from configuration file demo_module_3.conf
     - use of SNMP_CALLBACK_POST_READ_CONFIG
     
See the System Management Agent Developer's Guide for more information 
about traps, and demo_module_3.
     
     

How to Use the demo_module_3 Code Example
==========================================

The demo_module_3 code example includes the following files, by default 
located in the directory demo_module_3.

Files:

* Makefile - Compiles the module source code
* demo_module_3.c - Source code for the module
* demo_module_3.h - Header file for the module
* SDK-DEMO3-MIB.txt - MIB file used in the module
demo_module_3.conf - configuration file used by the module



To set up your environment for the demo:

1. Copy the demo code to a directory for which you have write permission.
   For example:

   $ cp -R demo_module_3  $HOME/XR/demo


2. Create a lib directory that you can use to store shared object libraries  
   that you generate from demo code examples, if you have not already done so. 
   For example:

   $ mkdir $HOME/XR/demo/lib

    
3. Create a mibs directory that you can use to store MIB files for the 
   demo code examples, if you have not already done so. 
   For example:

   $ mkdir $HOME/.snmp/mibs
   
   

To build the example:

1. Change to the directory where you copied the demo module files. 
   For example:

   $ cd $HOME/XR/demo/demo_module_3
   

2. Use the make command to generate object files.
  
   $ make
   

3. Copy the module shared library object to the lib directory you created. 
   For example:

   $ cp demo_module_3.so $HOME/XR/demo/lib
   
   
4. Copy the SDK-DEMO3-MIB.txt file to the mibs directory you created for 
   the demos.
   For example:
  
   $ cp SDK-DEMO3-MIB.txt $HOME/.snmp/mibs


5. Copy the demo_module_3.conf file to a .snmp directory in your home 
   directory.
   For example:
   
   $ mkdir $HOME/.snmp
   $ cp demo_module_3.conf $HOME/.snmp
   


Setting Up Agent to Run demo_module_3
=====================================
    
1. Edit the agent's configuration file $HOME/.snmp/snmpd.conf,
   and insert a dlmod statement for the module. This statement enables the 
   agent to load the module.
   For example:
   
   dlmod demo_module_3 $HOME/XR/demo/lib/demo_module_3.so
   
    
2. Start the snmp agent. If the agent is already running, 
   stop and  restart it in debug mode.
   For example:
   
    $ snmpd -Lo -f -Ddemo_module_3 <port>
    
    The optional -Ddemo_module_3 argument sends debugging statements from 
    demo_module_3. The -Lo option to send debugging statements to the screen 
    instead.



Testing the Module
==================

1. Set your MIBS and MIBDIRS environment variables to
   include the appropriate paths.  
   For example, in the csh: 
    
   $ export MIBS=+SDK-DEMO3-MIB ( or $ export MIBS=ALL )
   
   
2. To get data from the module, issue an snmpwalk request.
   For example:

   $ snmpwalk -v1 -c <community> <host>:<port> .1.3.6.1.4.1.4242.3
   SDK-DEMO3-MIB::me3SystemLoadAvg1min.0  = STRING: "0.043"
   SDK-DEMO3-MIB::me3SystemLoadAvg5min.0  = STRING: "0.031"
   SDK-DEMO3-MIB::me3SystemLoadAvg15min.0  = STRING: "0.027"
   SDK-DEMO3-MIB::statusOID.0 = OID: SNMPv2-SMI::zeroDotZero.0
   SDK-DEMO3-MIB::objectStatus.0 = ""
   SDK-DEMO3-MIB::eventDescription.0 = ""
  

To catch traps generated by the module:


1. Edit the $HOME/.snmp/demo_module_3.conf file and set the 
   thresholds to values that are less than the current load values that 
   were returned in the snmpwalk command.
   
2. Edit the $HOME/.snmp/snmpd.conf file and add
   the following lines to configure the snmp agent to send traps.
   
   trapsink localhost <community> <port>


3. Open a second terminal window and, start snmptrapd in that window.
   For example, this command starts snmpdtrapd and specifies the format
   of the output to stderr:
   
   $ snmptrapd -f -Le -F "TRAP from %B on %m/%l/%y at %h:%j:%k \
     Enterprise=%N Type=%w SubType=%q \nwith Varbinds: %v \n\n" <port>
   
   NET-SNMP version 5.2.2 Started.
     
     
4. In the first window, restart the agent.
   For example:
   
   $ snmpd -f <port> 
   

5. In the terminal where snmptrapd is running you should see traps that are 
   generated by the agent.
   
   Trap output should be similar to the following:

   TRAP from torno00 on 5/15/2006 at 12:18:56      Enterprise=. Type=0 SubType=0
   with Varbinds: SNMPv2-MIB::sysUpTime.0 = Timeticks: (13515) 0:02:15.15  
   SNMPv2-MIB::snmpTrapOID.0 = OID: SNMPv2-SMI::enterprises.4242.0.1    
   SNMPv2-SMI::enterprises.4242.3.3.1.0 = OID: SNMPv2-SMI::enterprises.4242.1.1.1.0        
   SNMPv2-SMI::enterprises.4242.3.3.2.0 = STRING: "OK"  
   SNMPv2-SMI::enterprises.4242.3.3.3.0 = STRING: "Load Average over last 1 minute crossed the threshold "

6. To get data from the module, issue an snmpwalk request.
   For example:
   
   $ snmpwalk -v1 -c <community> <host>:<port> .1.3.6.1.4.1.4242.3
   SDK-DEMO3-MIB::me3SystemLoadAvg1min.0 = STRING: "0.010"
   SDK-DEMO3-MIB::me3SystemLoadAvg5min.0 = STRING: "0.070"
   SDK-DEMO3-MIB::me3SystemLoadAvg15min.0 = STRING: "0.100"
   SDK-DEMO3-MIB::statusOID.0 = OID: SDK-DEMO1-MIB::me1SystemLoadAvg1min.0
   SDK-DEMO3-MIB::objectStatus.0 = STRING: "OK"
   SDK-DEMO3-MIB::eventDescription.0 = STRING: "Load Average over last 1 minute crossed the threshold "





